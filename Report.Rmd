---
title: "Report"
author: 'Alan Wu, Oscar Su, Sean Gee, Shelby Jackson, Alton Law'
date: "2025-02-25"
output: html_document
---

```{r, echo = T, warning=FALSE, message=FALSE}
library(tidyverse)
library(car)
library(GGally)
library(MASS)
library(vtable)
data <- read.csv("cleaned_dataset.csv", header=TRUE) %>% dplyr::select(-X)
attach(data)
```
# Summary statistics and data exploration

## Distribution of categorical variables
```{r}
par(mfrow = c(1, 2))
company_type <- table(NACE.Letter)
barplot(company_type, xlab="Company Type by NACE Letters", ylab="Count")

report_years <- table(Report.Year)
barplot(report_years, xlab="Year Reported", ylab="Count")
```

## Extract variables
```{r}
new_table <- data.frame(Report.Year, Mean.Hourly.Gap, Median.Hourly.Gap, Q1.Female, Q2.Female, Q3.Female, Q4.Female, Percentage.Employees.Female)

## Descriptive tables
st(new_table, digits=4)

cor(new_table)
pairs(new_table)
```

### Distribution of variables
```{r}
par(mfrow = c(2,4))
for (col in 2:ncol(new_table)){
  hist(new_table[, col], main=colnames(new_table)[col], xlab=colnames(new_table)[col])
}
```

## Results and Interpretation
```{r}
full_model <- lm(Mean.Hourly.Gap ~ Report.Year+Q1.Female+Q2.Female+Q3.Female+Q4.Female, data = data)
summary(full_model)
```

From the full model, we derive the equation:
$$Mean.Hourly.Gap = -0.087(Report.Year) + 0.35(Q1.Female) + 0.255(Q2.Female) + 0.153(Q3.Female) + -0.731(Q4.Female)$$
The summary indicates an $R^2$ value of 0.4615, meaning 46.15% of the variation in mean hourly gap can be explained by the variables: Report.Year, Q1.Female, Q2.Female, Q3.Female, Q4.Female
The p-value is 2.2e-16 which is less than 0.05, giving significant evidence to reject the null hypothesis meaning of the predictors in the model is significant.

```{r}
par(mfrow = c(2,2))
plot(full_model)
```

The Residuals vs Fitted plot shows the relationship is linear at mean 0. The Q-Q plot shows heavy tailing indicating deviation from normality. There also seems to be non-constant variance shown in the standardized residuals plot which violates the linear model assumption. Residuals vs Leverage doesn't show any outliers or leverage points that need inspection.

```{r}
scatter_data <- data[, c("Mean.Hourly.Gap", "Report.Year", "Q1.Female", "Q2.Female", "Q3.Female", "Q4.Female")]
ggpairs(scatter_data, 
        title = "Scatter Plot Matrix of Full Model Variables",
        aes(alpha = 0.6))
```

The density plots on the diagonal show that Mean.Hourly.Gap is still right-skewed, reinforcing the need for a log transformation to improve normality. The correlation values confirm multicollinearity among Q1.Female, Q2.Female, Q3.Female, and Q4.Female, with correlations reaching 0.881, indicating that some of these predictors may be redundant and could inflate variance in the model. The scatter plots illustrate strong positive linear relationships between the quartile-based female representation variables, further supporting the presence of collinearity. Meanwhile, Report.Year exhibits weak correlations with all variables, implying that it likely does not play a significant role in predicting the gender pay gap.

```{r}
# VIF
vif(full_model)  # If VIF > 5, consider removing redundant variables
```

The VIF indicate moderate multicollinearity among Q1.Female, Q2.Female, Q3.Female, and Q4.Female, with Q3.Female exceeding the threshold of 5, suggesting that some predictors may be redundant and could inflate standard errors.

# Weighted Least Solutions
```{r}
ols_model <- lm(Mean.Hourly.Gap ~ Q1.Female + Q2.Female + Q3.Female + Q4.Female, data = df_cleaned)
residuals_ols <- abs(resid(ols_model))
variance_model <- lm(residuals_ols ~ fitted(ols_model))
weights <- 1 / (fitted(variance_model)^2)

wls_model <- lm(Mean.Hourly.Gap ~ Q1.Female + Q2.Female + Q3.Female + Q4.Female, 
                data = df_cleaned, weights = weights)
summary(wls_model)
```

```{r}
par(mfrow = c(2, 2))
plot(wls_model) 
